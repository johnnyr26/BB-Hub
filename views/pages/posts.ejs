<!DOCTYPE html>
<html>
    <head>
        <%- include('../partials/analytics'); -%>
        <link  href='/css/style.css' type="text/css" rel='stylesheet'/>
        <link href="/css/header.css" type="text/css" rel="stylesheet">
        <link href="/css/index.css" type="text/css" rel="stylesheet"/>
        <link href="/css/posts.css" type="text/css" rel="stylesheet">
        <link rel="icon" type="image/png" href="/img/bb_hub_icon.jpg">
        <link rel="shortcut icon" type="image/png" href="/img/bb_hub_icon.jpg"/>
        <link rel="apple-touch-icon" href="/img/bb_hub_icon.jpg"> 
        <link rel="manifest" href="manifest.json">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Announcements - BB Hub</title>
    </head>
    <body>
        <%- include('../partials/header'); -%>
        <main>
            <% if (admin) { %>
                <section class="new-posts-section">
                    <button class="create-new-post-button">Create a new announcement</button>
                    <div class="new-posts-div invisible">  
                        <h1>New Announcement</h1>
                        <input class="posts-title-textfield" type="text" placeholder="Title" required>
                        <textarea class="posts-message-textarea" placeholder="Message" required></textarea>
                        <label for="image-upload" class="image-upload-label">
                            <img class="upload-photo-icon" src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHZpZXdCb3g9IjAgMCAxNzIgMTcyIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9Im5vbnplcm8iIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBzdHJva2UtbGluZWNhcD0iYnV0dCIgc3Ryb2tlLWxpbmVqb2luPSJtaXRlciIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBzdHJva2UtZGFzaGFycmF5PSIiIHN0cm9rZS1kYXNob2Zmc2V0PSIwIiBmb250LWZhbWlseT0ibm9uZSIgZm9udC13ZWlnaHQ9Im5vbmUiIGZvbnQtc2l6ZT0ibm9uZSIgdGV4dC1hbmNob3I9Im5vbmUiIHN0eWxlPSJtaXgtYmxlbmQtbW9kZTogbm9ybWFsIj48cGF0aCBkPSJNMCwxNzJ2LTE3MmgxNzJ2MTcyeiIgZmlsbD0ibm9uZSI+PC9wYXRoPjxnIGZpbGw9IiMxNDcyZmYiPjxwYXRoIGQ9Ik02OS44NzUsMTQuMzMzMzNjLTguODg2NjcsMCAtMTYuMTI1LDcuMjM4MzMgLTE2LjEyNSwxNi4xMjV2MzAuNDU4MzNoMTAuNzV2LTMwLjQ1ODMzYzAsLTIuOTc0MTcgMi40MDA4MywtNS4zNzUgNS4zNzUsLTUuMzc1aDc1LjI1YzIuOTc0MTcsMCA1LjM3NSwyLjQwMDgzIDUuMzc1LDUuMzc1djU3LjMzMzMzYzAsMi45NzQxNyAtMi40MDA4Myw1LjM3NSAtNS4zNzUsNS4zNzVoLTE5LjcwODMzdjEwLjc1aDE5LjcwODMzYzguODg2NjcsMCAxNi4xMjUsLTcuMjM4MzMgMTYuMTI1LC0xNi4xMjV2LTU3LjMzMzMzYzAsLTguODg2NjcgLTcuMjM4MzMsLTE2LjEyNSAtMTYuMTI1LC0xNi4xMjV6TTc1LjI1LDMyLjI1Yy0xLjk3MDgzLDAgLTMuNTgzMzMsMS42MTI1IC0zLjU4MzMzLDMuNTgzMzN2My41ODMzM2MwLDEuOTcwODMgMS42MTI1LDMuNTgzMzMgMy41ODMzMywzLjU4MzMzaDMuNTgzMzNjMS45NzA4MywwIDMuNTgzMzMsLTEuNjEyNSAzLjU4MzMzLC0zLjU4MzMzdi0zLjU4MzMzYzAsLTEuOTcwODMgLTEuNjEyNSwtMy41ODMzMyAtMy41ODMzMywtMy41ODMzM3pNMTM2LjE2NjY3LDMyLjI1Yy0xLjk3OCwwIC0zLjU4MzMzLDEuNjA1MzMgLTMuNTgzMzMsMy41ODMzM3YzLjU4MzMzYzAsMS45NzggMS42MDUzMywzLjU4MzMzIDMuNTgzMzMsMy41ODMzM2gzLjU4MzMzYzEuOTc4LDAgMy41ODMzMywtMS42MDUzMyAzLjU4MzMzLC0zLjU4MzMzdi0zLjU4MzMzYzAsLTEuOTc4IC0xLjYwNTMzLC0zLjU4MzMzIC0zLjU4MzMzLC0zLjU4MzMzek03NS4yNSw1My43NWMtMS45NzA4MywwIC0zLjU4MzMzLDEuNjEyNSAtMy41ODMzMywzLjU4MzMzdjMuNTgzMzNoMTAuNzV2LTMuNTgzMzNjMCwtMS45NzA4MyAtMS42MTI1LC0zLjU4MzMzIC0zLjU4MzMzLC0zLjU4MzMzek0xMzYuMTY2NjcsNTMuNzVjLTEuOTc4LDAgLTMuNTgzMzMsMS42MDUzMyAtMy41ODMzMywzLjU4MzMzdjMuNTgzMzNjMCwxLjk3OCAxLjYwNTMzLDMuNTgzMzMgMy41ODMzMywzLjU4MzMzaDMuNTgzMzNjMS45NzgsMCAzLjU4MzMzLC0xLjYwNTMzIDMuNTgzMzMsLTMuNTgzMzN2LTMuNTgzMzNjMCwtMS45NzggLTEuNjA1MzMsLTMuNTgzMzMgLTMuNTgzMzMsLTMuNTgzMzN6TTI2Ljg3NSw2OC4wODMzM2MtOC44NDE4OCwwIC0xNi4xMjUsNy4yODMxMiAtMTYuMTI1LDE2LjEyNXY1Ny4zMzMzM2MwLDguODQxODggNy4yODMxMiwxNi4xMjUgMTYuMTI1LDE2LjEyNWg3NS4yNWM4Ljg0MTg4LDAgMTYuMTI1LC03LjI4MzEyIDE2LjEyNSwtMTYuMTI1di01Ny4zMzMzM2MwLC04Ljg0MTg4IC03LjI4MzEyLC0xNi4xMjUgLTE2LjEyNSwtMTYuMTI1ek0xMzYuMTY2NjcsNzUuMjVjLTEuOTc4LDAgLTMuNTgzMzMsMS42MDUzMyAtMy41ODMzMywzLjU4MzMzdjMuNTgzMzNjMCwxLjk3OCAxLjYwNTMzLDMuNTgzMzMgMy41ODMzMywzLjU4MzMzaDMuNTgzMzNjMS45NzgsMCAzLjU4MzMzLC0xLjYwNTMzIDMuNTgzMzMsLTMuNTgzMzN2LTMuNTgzMzNjMCwtMS45NzggLTEuNjA1MzMsLTMuNTgzMzMgLTMuNTgzMzMsLTMuNTgzMzN6TTI2Ljg3NSw3OC44MzMzM2g3NS4yNWMzLjAzMzI5LDAgNS4zNzUsMi4zNDE3MSA1LjM3NSw1LjM3NXY0OS4xMjM4NmwtMTkuNTg5MzYsLTE4Ljk4NzQ3Yy00LjQ1NTk2LC00LjMxMDMgLTExLjY3NjAzLC00LjMxMDMgLTE2LjEzMiwwbC01LjMxMjAxLDUuMTM3MDVsLTEyLjcyMzYzLC0xMi4zMDM3MWMtMi4yMjc5OCwtMi4xNTUxNSAtNS4xNDQ1NCwtMy4yMzM0IC04LjA2MjUsLTMuMjMzNGMtMi45MTc5NiwwIC01LjgzNDUyLDEuMDc4MjUgLTguMDYyNSwzLjIzMzRsLTE2LjExOCwxNS41OTMxdi0zOC41NjI4M2MwLC0zLjAzMzI5IDIuMzQxNzEsLTUuMzc1IDUuMzc1LC01LjM3NXpNODkuNTgzMzMsODkuNTgzMzNjLTMuOTU4MDQsMCAtNy4xNjY2NywzLjIwODYzIC03LjE2NjY3LDcuMTY2NjdjMCwzLjk1ODA0IDMuMjA4NjMsNy4xNjY2NyA3LjE2NjY3LDcuMTY2NjdjMy45NTgwNCwwIDcuMTY2NjcsLTMuMjA4NjMgNy4xNjY2NywtNy4xNjY2N2MwLC0zLjk1ODA0IC0zLjIwODYzLC03LjE2NjY3IC03LjE2NjY3LC03LjE2NjY3ek00NS42ODA1LDExNC42Mzg2N2MwLjIwMzksMCAwLjQwNDI5LDAuMDg4MzQgMC41ODc4OSwwLjI2NTk1bDEyLjQ2NDY4LDEyLjA1ODc2bC0yMC42MjUxNiwxOS45NTMyOWgtMTEuMjMyOTFjLTMuMDMzMjksMCAtNS4zNzUsLTIuMzQxNzEgLTUuMzc1LC01LjM3NXYtMy44MTQyOWwyMy41ODU2MSwtMjIuODIyNzZjMC4xODM2LC0wLjE3NzYxIDAuMzkxLC0wLjI2NTk1IDAuNTk0ODksLTAuMjY1OTV6TTc5Ljg0ODE0LDEyMS44MDUzNGMwLjIwMzksMCAwLjQwNDI5LDAuMDg4MzQgMC41ODc4OSwwLjI2NTk1bDI0LjcwNTQsMjMuOTQ5NTVjLTAuODUzNDksMC41NjYyNyAtMS44ODQ3LDAuODk1ODMgLTMuMDE2NDQsMC44OTU4M2gtNDguNTU2OTdsMjUuNjg1MjIsLTI0Ljg0NTM4YzAuMTgzNiwtMC4xNzc2MSAwLjM5MDk5LC0wLjI2NTk1IDAuNTk0ODksLTAuMjY1OTV6Ij48L3BhdGg+PC9nPjwvZz48L3N2Zz4=" alt="icon" title="Upload a photo">
                            <p class="upload-photo-label">Upload Photo</p>
                        </label>
                        <input id="image-upload" type="file" id="img" name="img" accept="image/png, image/jpeg">
                        <img alt="uploaded photo" class="posts-image-upload-div invisible"/>
                        <p class="error-message invisible"></p>
                        <button class="submit-post-button" type="submit" id="submit">Submit</button>
                    </div>
                </section>
            <% } %>
            <% if (locals.posts) { %>
                <div class="columns">
                    <div class="column">
                        <% const firstColPosts = posts.filter((post, index) => index % 3 === 0); %>
                        <% firstColPosts.forEach(post => { %>
                            <section class="announcements-section">
                                <div class="announcements-section-title section-title">
                                    <% if (post.img.data) { %>
                                        <% const b64 = Buffer.from(post.img.data.buffer).toString('base64') %>
                                        <img class="announcements-image" alt="Image" src="data:image/jpeg;base64, <%= b64 %>">
                                    <% } %>
                                </div>
                                <div class="section-body announcements-section-body">
                                    <% if (post.user) { %>
                                        <a href="/users/<%= post.user._id %>" class="user-info">
                                            <img alt="profile-image" src="<%= post.user.picture %>"/>
                                            <p class="announcements-body userlink"><%= post.user.name %></p>
                                        </a>
                                    <% } %>
                                    <h1 class="announcements-title-heading"><%= post.title %></h1>
                                    <p class="announcements-body"><%= post.message %></p>
                                </div>
                            </section>
                        <% }); %>
                    </div>
                    <div class="column">
                        <% const secondColPosts = posts.filter((post, index) => index % 3 === 1); %>
                        <% secondColPosts.forEach(post => { %>
                            <section class="announcements-section">
                                <div class="announcements-section-title section-title">
                                    <% if (post.img.data) { %>
                                        <% const b64 = Buffer.from(post.img.data.buffer).toString('base64') %>
                                        <img class="announcements-image" alt="Image" src="data:image/jpeg;base64, <%= b64 %>">
                                    <% } %>
                                </div>
                                <div class="section-body announcements-section-body">
                                    <% if (post.user) { %>
                                        <a href="/users/<%= post.user._id %>" class="user-info">
                                            <img alt="profile-image" src="<%= post.user.picture %>"/>
                                            <p class="announcements-body userlink"><%= post.user.name %></p>
                                        </a>
                                    <% } %>
                                    <h1 class="announcements-title-heading"><%= post.title %></h1>
                                    <p class="announcements-body"><%= post.message %></p>
                                </div>
                            </section>
                        <% }); %>
                    </div>
                    <div class="column">
                        <% const thirdColPosts = posts.filter((post, index) => index % 3 === 2); %>
                        <% thirdColPosts.forEach(post => { %>
                            <section class="announcements-section">
                                <div class="announcements-section-title section-title">
                                    <% if (post.img.data) { %>
                                        <% const b64 = Buffer.from(post.img.data.buffer).toString('base64') %>
                                        <img class="announcements-image" alt="Image" src="data:image/jpeg;base64, <%= b64 %>">
                                    <% } %>
                                </div>
                                <div class="section-body announcements-section-body">
                                    <% if (post.user) { %>
                                        <a href="/users/<%= post.user._id %>" class="user-info">
                                            <img alt="profile-image" src="<%= post.user.picture %>"/>
                                            <p class="announcements-body userlink"><%= post.user.name %></p>
                                        </a>
                                    <% } %>
                                    <h1 class="announcements-title-heading"><%= post.title %></h1>
                                    <p class="announcements-body"><%= post.message %></p>
                                </div>
                            </section>
                        <% }); %>
                    </div>
                </div>
            <% } %>
        </main>
        <script src="/js/posts.js"></script>
    </body>
</html>